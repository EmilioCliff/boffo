// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: helpers.sql

package generated

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getAdminStats = `-- name: GetAdminStats :one
SELECT id, total_company_stock, total_stock_distributed, total_value_distributed, total_payments_received FROM admin_stats
WHERE id = $1
`

func (q *Queries) GetAdminStats(ctx context.Context, id int32) (AdminStat, error) {
	row := q.db.QueryRow(ctx, getAdminStats, id)
	var i AdminStat
	err := row.Scan(
		&i.ID,
		&i.TotalCompanyStock,
		&i.TotalStockDistributed,
		&i.TotalValueDistributed,
		&i.TotalPaymentsReceived,
	)
	return i, err
}

const getResellerNameByID = `-- name: GetResellerNameByID :one


SELECT name FROM users
WHERE id = $1
`

// -- name: GetDashboardData :one
// WITH low_stock AS (
//
//	SELECT id, name, stock, low_stock_threshold
//	FROM products
//	WHERE deleted = false
//	ORDER BY stock ASC
//	LIMIT 3
//
// ),
// recent_stock_in AS (
//
//	SELECT m.id, p.name AS product_name, m.quantity, m.price, m.created_at
//	FROM movements m
//	JOIN products p ON p.id = m.product_id
//	WHERE m.type = 'ADD'
//	ORDER BY m.created_at DESC
//	LIMIT 5
//
// ),
// recent_stock_out AS (
//
//	SELECT m.id, p.name AS product_name, m.quantity, m.price, m.created_at
//	FROM movements m
//	JOIN products p ON p.id = m.product_id
//	WHERE m.type = 'REMOVE'
//	ORDER BY m.created_at DESC
//	LIMIT 5
//
// )
// SELECT
//
//	json_build_object(
//	  'low_stock', (SELECT json_agg(low_stock) FROM low_stock),
//	  'recent_stock_in', (SELECT json_agg(recent_stock_in) FROM recent_stock_in),
//	  'recent_stock_out', (SELECT json_agg(recent_stock_out) FROM recent_stock_out)
//	) AS dashboard_data;
//
// -- name: GetWeeklySales :many
// WITH date_series AS (
//
//	SELECT generate_series::date AS day
//	FROM generate_series(
//	  (CURRENT_DATE - INTERVAL '6 days'),
//	  CURRENT_DATE,
//	  INTERVAL '1 day'
//	)
//
// ),
// sales_data AS (
//
//	SELECT
//	  created_at::date AS day,
//	  SUM(quantity) AS sales,
//	  COUNT(*) AS total_transacted,
//	  SUM(price * quantity) AS total_amount
//	FROM movements
//	WHERE type = 'REMOVE'
//	  AND created_at >= NOW() - INTERVAL '7 days'
//	GROUP BY created_at::date
//
// )
// SELECT
//
//	to_char(ds.day, 'Dy') AS day,
//	COALESCE(sd.sales, 0) AS sales,
//	COALESCE(sd.total_transacted, 0) AS total_transacted,
//	COALESCE(sd.total_amount, 0) AS total_amount
//
// FROM date_series ds
// LEFT JOIN sales_data sd ON ds.day = sd.day
// ORDER BY ds.day;
func (q *Queries) GetResellerNameByID(ctx context.Context, resellerID int64) (string, error) {
	row := q.db.QueryRow(ctx, getResellerNameByID, resellerID)
	var name string
	err := row.Scan(&name)
	return name, err
}

const updateAdminStats = `-- name: UpdateAdminStats :one
UPDATE admin_stats
SET total_company_stock = coalesce($1, total_company_stock),
    total_stock_distributed = coalesce($2, total_stock_distributed),
    total_value_distributed = coalesce($3, total_value_distributed),
    total_payments_received = coalesce($4, total_payments_received)
WHERE id = $5
RETURNING id, total_company_stock, total_stock_distributed, total_value_distributed, total_payments_received
`

type UpdateAdminStatsParams struct {
	TotalCompanyStock     pgtype.Int8    `json:"total_company_stock"`
	TotalStockDistributed pgtype.Int8    `json:"total_stock_distributed"`
	TotalValueDistributed pgtype.Numeric `json:"total_value_distributed"`
	TotalPaymentsReceived pgtype.Numeric `json:"total_payments_received"`
	ID                    int32          `json:"id"`
}

func (q *Queries) UpdateAdminStats(ctx context.Context, arg UpdateAdminStatsParams) (AdminStat, error) {
	row := q.db.QueryRow(ctx, updateAdminStats,
		arg.TotalCompanyStock,
		arg.TotalStockDistributed,
		arg.TotalValueDistributed,
		arg.TotalPaymentsReceived,
		arg.ID,
	)
	var i AdminStat
	err := row.Scan(
		&i.ID,
		&i.TotalCompanyStock,
		&i.TotalStockDistributed,
		&i.TotalValueDistributed,
		&i.TotalPaymentsReceived,
	)
	return i, err
}
